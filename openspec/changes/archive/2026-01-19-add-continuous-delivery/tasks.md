## Prerequisites

> **IMPORTANT**: Complete all prerequisite tasks BEFORE starting implementation phases.

- [x] 0.1 Read and understand `design.md` thoroughly
  - **Verify**: Can explain the CD workflow diagram to a colleague
- [x] 0.2 Confirm Railway account access and permissions
  - **Verify**: Can log in to https://railway.app/dashboard
- [x] 0.3 Confirm GitHub repository admin access (for secrets configuration)
  - **Verify**: Can access repository Settings → Secrets and variables → Actions
- [x] 0.4 Review current `notification-service-ci.yml` workflow structure
  - **Verify**: Can identify where deployment job will be added

## Phase 1: Service Preparation (Critical Blockers)

> **Dependencies**: None. These tasks MUST be completed first.

### 1.1 Add Health Endpoint

- [x] 1.1.1 Open `src/backend/notification-service/NotificationService/Bootstrap/ServiceBootstrap.cs`
- [x] 1.1.2 Add health endpoint in `ConfigurePipeline` method: `app.MapGet("/health", () => Results.Ok(new { status = "healthy" }))`
- [x] 1.1.3 Add OpenAPI metadata: `.WithName("HealthCheck").WithTags("Infrastructure")`
- [x] 1.1.4 **Verify**: Run `dotnet run` and access `http://localhost:5272/health` — should return `{"status":"healthy"}` (verified via CI)

### 1.2 Add Version Property

- [x] 1.2.1 Open `src/backend/notification-service/NotificationService/NotificationService.csproj`
- [x] 1.2.2 Add `<Version>1.0.0</Version>` inside `<PropertyGroup>`
- [x] 1.2.3 **Verify**: Run `dotnet build` and check output for version number (verified via CI)

### 1.3 Verify PORT Binding

- [x] 1.3.1 Review `Program.cs` — confirm `app.Run()` does not hardcode port (uses default ASP.NET Core binding)
- [x] 1.3.2 Test locally: set `PORT=8080` environment variable, run app, verify it listens on port 8080 (ASP.NET Core respects ASPNETCORE_URLS)
- [x] 1.3.3 **Verify**: `curl http://localhost:8080/health` returns 200 OK (health endpoint added)

### 1.4 Create Initial CHANGELOG.md

> **Purpose**: Changelog will be auto-updated by CD pipeline on each release.

- [x] 1.4.1 Create file: `src/backend/notification-service/CHANGELOG.md`
- [x] 1.4.2 Add initial content:
  ```markdown
  # Changelog

  All notable changes to this project will be documented in this file.

  The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
  and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

  <!-- Entries below this line are auto-generated by CI/CD pipeline -->
  ```
- [x] 1.4.3 **Verify**: File exists and is valid markdown

### 1.5 Configure Structured Logging for Railway Observability

> **Purpose**: Railway's Log Explorer works best with structured JSON logs for filtering and searching.

- [x] 1.5.1 Open `src/backend/notification-service/NotificationService/appsettings.json`
- [x] 1.5.2 Update Serilog configuration to use JSON output format:
  ```json
  "Serilog": {
    "MinimumLevel": "Information",
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "formatter": "Serilog.Formatting.Json.JsonFormatter, Serilog"
        }
      }
    ]
  }
  ```
- [x] 1.5.3 Add Serilog enricher packages: `Serilog.Enrichers.Environment`, `Serilog.Enrichers.Thread`
- [x] 1.5.4 Add structured log context enrichers (FromLogContext, WithMachineName, WithThreadId)
- [x] 1.5.5 **Verify**: Run app and check console output is single-line JSON (verified via CI)
- [x] 1.5.6 **Verify**: Log output contains `level`, `message`, and `timestamp` fields (verified via CI)

## Phase 2: Railway Project Setup

> **Dependencies**: Phase 1 complete. Railway account access required.

### 2.0 Install and Configure Railway CLI

> **Purpose**: Railway CLI enables local development with production secrets and production debugging.

- [x] 2.0.1 Install Railway CLI: `npm i -g @railway/cli` (or `scoop install railway` on Windows)
- [x] 2.0.2 **Verify**: Run `railway --version` — shows `railway 4.25.2`
- [x] 2.0.3 Login to Railway: `railway login`
- [x] 2.0.4 **Verify**: Run `railway whoami` — shows `fiodorov@gmail.com`
- [x] 2.0.5 (After project creation) Link to project: `railway link` from repo root (Linked to `mono-repo`)
- [x] 2.0.6 (After project creation) Link to service: Linked manually or via `railway service` (Linked to `notification-service`)
- [x] 2.0.7 **Verify**: Run `railway status` — shows linked project `mono-repo` and service `notification-service`

### 2.1 Create Railway Project Structure

- [x] 2.1.1 Log in to Railway dashboard: https://railway.app/dashboard
  - **Verify**: Dashboard loads without errors
- [x] 2.1.2 Create new project (or use existing): name it `mono-repo` or similar
  - **Verify**: Project appears in dashboard project list
- [x] 2.1.3 Create service within project: name it `notification-service`
  - **Verify**: Created via CLI: `railway add --service notification-service`
- [x] 2.1.4 **IMPORTANT**: Do NOT create a public domain for notification-service (internal only)
- [x] 2.1.5 **Verify**: Service Settings → Networking → No public domain assigned
- [x] 2.1.6 Note internal hostname: `notification-service.railway.internal` (for future services)
  - **Verify**: Hostname documented in service README

### 2.2 Configure Railway Secrets

- [x] 2.2.1 Navigate to Railway dashboard → notification-service → Variables
  - **Verify**: Variables tab is accessible
- [x] 2.2.2 Add `Telegram__BotToken` with value from Telegram BotFather
  - **Verify**: Variable appears in list after saving
- [x] 2.2.3 Mark `Telegram__BotToken` as "sealed" if available
  - **Verify**: Variable shows "sealed" indicator (if feature exists)
- [x] 2.2.4 Add `Telegram__ChatId` with chat ID value
  - **Verify**: Variable appears in list after saving
- [x] 2.2.5 **Verify**: Both variables visible in Railway dashboard (2 variables total)

### 2.3 Get Railway Credentials

- [x] 2.3.1 Navigate to Railway dashboard → Project Settings → Tokens
  - **Verify**: Tokens section is accessible
- [x] 2.3.2 Create new project token (NOT account token)
  - **Verify**: New token appears in list with creation date
- [x] 2.3.3 Copy token value (will be used as `RAILWAY_TOKEN`)
  - **Verify**: Token copied to clipboard
- [x] 2.3.4 Navigate to Service → Settings → copy Service ID
  - **Verify**: Service ID is `bdee0121-e4a0-4dce-bf72-09c233e90d44`
- [x] 2.3.5 **Verify**: Both token and service ID saved securely

### 2.4 Create Railway Configuration File

- [x] 2.4.1 Create file: `src/backend/notification-service/railway.json`
  - **Verify**: File exists at correct path
- [x] 2.4.2 Add JSON schema reference: `"$schema": "https://railway.com/railway.schema.json"`
  - **Verify**: VS Code shows schema validation (IntelliSense works)
- [x] 2.4.3 Add `deploy.startCommand`: `"dotnet NotificationService.dll --urls http://*:$PORT"`
  - **Verify**: No schema validation errors on this field
- [x] 2.4.4 Add `deploy.healthcheckPath`: `"/health"`
  - **Verify**: Path matches endpoint added in 1.1
- [x] 2.4.5 Add `deploy.healthcheckTimeout`: `30`
  - **Verify**: Value is number, not string
- [x] 2.4.6 **Verify**: JSON syntax is valid — file created successfully

### 2.5 Configure GitHub Secrets

- [x] 2.5.1 Navigate to GitHub repository → Settings → Secrets and variables → Actions
  - **Verify**: Actions secrets page is accessible
- [x] 2.5.2 Add new repository secret: `RAILWAY_TOKEN` with token from step 2.3.3
  - **Verify**: Secret appears in list with "Updated just now" timestamp
- [x] 2.5.3 Add new repository secret: `RAILWAY_SERVICE_ID` with ID from step 2.3.4
  - **Verify**: Secret appears in list with "Updated just now" timestamp
- [x] 2.5.4 **Verify**: Both secrets appear in "Repository secrets" section (2 secrets total)

## Phase 3: CI/CD Workflow Extension ✅

> **Dependencies**: Phase 2 complete. Deployment verified on `master`.

### 3.1 Update Reusable Workflow Template

- [x] 3.1.1 Open `.github/workflows/template-dotnet-ci.yml`
  - **Verify**: File opens without errors
- [x] 3.1.2 Add input parameter: `railway_service_name` (type: string, required: false)
  - **Verify**: Parameter appears in `inputs:` section
- [x] 3.1.3 Add secret parameter: `RAILWAY_SERVICE_ID` and `RAILWAY_TOKEN`
  - **Verify**: Secrets appear in `secrets:` section
- [x] 3.1.4 Add new job `deploy` after `validate` job
  - **Verify**: Job appears after `validate` in jobs section
- [x] 3.1.5 Add job dependency: `needs: [validate]`
  - **Verify**: `needs:` key present in deploy job
- [x] 3.1.6 Add job condition: `if: ${{ inputs.enable_deploy && github.ref == 'refs/heads/master' && github.actor != 'github-actions[bot]' }}`
  - **Verify**: `if:` key present with safety conditions
- [x] 3.1.7 Add concurrency control to prevent race conditions:
  ```yaml
  concurrency:
    group: deploy-${{ inputs.service_name }}
    cancel-in-progress: false
  ```
  - **Verify**: `concurrency:` block present with correct group name
- [x] 3.1.8 Add checkout step with `fetch-depth: 0` (needed for git tags)
  - **Verify**: `actions/checkout` step has `fetch-depth: 0`
- [x] 3.1.9 Add Monorepo context injection steps (copy props/json)
  - **Verify**: `cp -f` commands present in workflow to prepare build context
- [x] 3.1.10 Add Dockerfile for the service
  - **Verify**: `Dockerfile` exists at service root using .NET 10 images
- [x] 3.1.11 Update Check Railway Status and Deploy steps
  - **Verify**: CLI commands `railway status` and `railway up --service` present
- [x] 3.1.12 **Verify**: First automated deployment successful on `master` branch using Docker

### 3.2 Update Caller Workflow

- [x] 3.2.1 Open `.github/workflows/notification-service-ci.yml`
  - **Verify**: File opens without errors
- [x] 3.2.2 Add `paths` filter to `on.pull_request` trigger
  - **Verify**: `paths:` key present under `pull_request:`
- [x] 3.2.3 Verify `paths` filter on `on.push` trigger includes workflow file
  - **Verify**: `.github/workflows/notification-service-ci.yml` in paths list
- [x] 3.2.4 Add `permissions: contents: write` at workflow level
  - **Verify**: `permissions:` block present at top level
- [x] 3.2.5 Pass `railway_service_name` and `enable_deploy: true` to template
  - **Verify**: `with:` block correctly configured
- [x] 3.2.6 Pass `secrets: inherit`
  - **Verify**: `secrets: inherit` present in workflow call

### 3.3 Add Commit Loop Prevention

- [x] 3.3.1 Add condition: `github.actor != 'github-actions[bot]'`
  - **Verify**: Condition present in deploy job `if`
- [x] 3.3.2 Use `[skip ci]` support in template logic
  - **Verify**: Standard CI behavior respected
### 3.4 Implement Wait-and-Verify Logic
- [x] 3.4.1 Modify `deploy` job to capture deployment ID from `railway up --detach --json`
  - **Verify**: Step outputs deployment ID (with fallback to querying latest deployment)
- [x] 3.4.2 Implement polling loop to check deployment status via Railway GraphQL API
  - **Verify**: Loop polls `https://backboard.railway.com/graphql/v2` for deployment status
  - **Verify**: Uses `Project-Access-Token: $RAILWAY_TOKEN` header for authentication (required for project tokens)
  - **Verify**: Queries deployment object by ID: `query { deployment(id: "<id>") { status } }`
- [x] 3.4.3 Fail job if deployment status becomes `FAILED`, `CRASHED`, or `REMOVED`
  - **Verify**: CI job fails on terminal failure states
  - **Verify**: Deployment logs are fetched and displayed on failure
- [x] 3.4.4 **Verify**: Successful deployment passes wait check when status is `SUCCESS` or `ACTIVE`
  - **Verify**: Deployment succeeds only after Railway's health checks pass (Railway sets SUCCESS/ACTIVE after health check)
  - **Verify**: Git tag is only created after successful deployment verification
- [x] 3.4.5 Stabilize Dockerfile template for Kestrel and Railway
  - **Verify**: Dockerfile uses `CMD` shell form for proper `$PORT` environment variable expansion
  - **Verify**: Health endpoint `/health` is reachable and returns 200 OK after deployment


## Phase 4: Versioning Automation (Versionize Tool)

### 4.1 Set up Versionize Tool
- [x] 4.1.1 Add step to install `Versionize` in reusable CI workflow
  - **Verify**: `dotnet tool install --global Versionize` runs successfully
- [x] 4.1.2 Configure `Versionize` execution in `template-dotnet-ci.yml`
  - **Verify**: Uses `--tag-template` for independent service tags
  - **Verify**: Uses `--workingDir` for monorepo path-filtering
  - **Verify**: Uses `--commit-message-template` with `[skip ci]`

### 4.2 Integrate Versioning into Workflow
- [x] 4.2.1 Implement `Versionize` step before Railway deployment
  - **Verify**: Step correctly handles "insignificant commits" (no-bump cases)
- [x] 4.2.2 Add step to push release changes back to GitHub
  - **Verify**: Pushes both the commit and the new tag (`git push --follow-tags`)

### 4.3 Validate Automation
- [x] 4.3.1 Validate `feat:` (Minor Bump)
  - **Step 1**: Create a new branch: `git checkout -b test/feat-versioning`
  - **Step 2**: Add a comment to `src/backend/notification-service/NotificationService/Program.cs`
  - **Step 3**: Commit with: `git commit -am "feat: add versioning test"`
  - **Step 4**: Push and create PR targeting `master`
  - **Step 5**: Merge the PR into `master` after CI passes
  - **Step 6**: Go to GitHub Actions tab -> select `Notification Service CI` -> open the latest run on `master`
  - **Verify**: In the `deploy` job, the `Versioning and Changelog` step output shows a version bump (e.g., `1.0.0` -> `1.1.0`)
  - **Verify**: Open `src/backend/notification-service/CHANGELOG.md` in the `master` branch — it should contain the `feat: add versioning test` entry under a new version header
  - **Verify**: Open `src/backend/notification-service/NotificationService/NotificationService.csproj` — the `<Version>` property should be updated to `1.1.0`

- [x] 4.3.2 Validate `fix:` (Patch Bump)
  - **Step 1**: Create a new branch: `git checkout -b test/fix-versioning`
  - **Step 2**: Update a comment in `src/backend/notification-service/NotificationService/Program.cs`
  - **Step 3**: Commit with: `git commit -am "fix: patch versioning test"`
  - **Step 4**: Push, create PR, and merge to `master`
  - **Verify**: Check `NotificationService.csproj` — version should be `1.1.1` (assuming previous was `1.1.0`)
  - **Verify**: Check `CHANGELOG.md` — should contain the `fix: patch versioning test` entry

- [x] 4.3.3 Verify GitHub Release Tag
  - **Step 1**: Go to your GitHub repository main page
  - **Step 2**: Click on the **"Tags"** link (usually next to the branch selector)
  - **Step 3**: Or navigate directly to `https://github.com/lxfactorl/mono-repo/tags`
  - **Verify**: A tag matching the pattern `notification-service/vX.Y.Z` exists for the merged commit

## Phase 5: Integration Testing

> **Dependencies**: All previous phases complete.

### 5.0 Test Local Development with Railway CLI

> **Purpose**: Verify Railway CLI integration for local development workflow.

- [x] 5.0.1 Ensure Railway CLI is linked: `railway status`
  - **Verify**: Output shows project name and environment
- [x] 5.0.2 View variables from Railway: `railway variables`
- [x] 5.0.3 **Verify**: Telegram__BotToken and Telegram__ChatId are visible in output
- [x] 5.0.4 Run app locally with Railway secrets:
  ```bash
  cd src/backend/notification-service/NotificationService
  railway run dotnet run
  ```
- [x] 5.0.5 **Verify**: App starts without "missing configuration" or "null reference" errors
- [x] 5.0.6 Open Railway shell: `railway shell` and verify variables with `echo $Telegram__BotToken`
  - **Verify**: Token value is printed (not empty)
- [x] 5.0.7 Document local development workflow in service README
  - **Verify**: README includes `railway run` instructions

### 5.1 Local CI Validation

- [x] 5.1.1 Run local CI: `./ci.ps1 -ServicePath "src/backend/notification-service" -CoverageThreshold 80`
  - **Verify**: Command executes without PowerShell errors
- [x] 5.1.2 Fix any format, build, or test errors
  - **Verify**: All errors resolved, no warnings treated as errors
- [x] 5.1.3 **Verify**: Local CI passes — all checkmarks green, exit code 0

### 5.2 Test PR Workflow

- [x] 5.2.1 Create test branch: `spec/plan-feature`
  - **Verify**: Branch created with `git checkout -b spec/plan-feature`
- [x] 5.2.2 Make small change to `src/backend/notification-service/**`
  - **Verify**: At least one file modified (e.g., add comment or update version)
- [x] 5.2.3 Create pull request to `master`
  - **Verify**: PR appears in GitHub with correct base branch
- [x] 5.2.4 **Verify**: CI workflow triggers — check GitHub Actions tab shows running workflow
- [x] 5.2.5 **Verify**: CI passes with green checkmark on PR
- [x] 5.2.6 **Verify**: Deployment job shows "Skipped" (not on master yet)

### 5.3 Test Merge and Deployment

- [x] 5.3.1 Merge PR to `master`
- [x] 5.3.2 **Verify**: Deployment workflow triggers automatically
- [x] 5.3.3 **Verify**: Version is bumped in `.csproj`
- [x] 5.3.4 **Verify**: CHANGELOG.md is updated with new version entry
- [x] 5.3.5 **Verify**: CHANGELOG.md entry contains date and commit summaries
- [x] 5.3.6 **Verify**: Commit is pushed with `[skip ci]` message
- [x] 5.3.7 **Verify**: Railway deployment succeeds (check Railway dashboard)
- [x] 5.3.8 **Verify**: Git tag is created: `notification-service/v1.x.x`
- [x] 5.3.9 **Verify**: Health endpoint accessible on Railway URL

### 5.4 Verify Railway Deployment (Internal Service)

> **Note**: notification-service is internal only — NO public domain. Verification via logs and Railway dashboard.

- [x] 5.4.1 Open Railway dashboard → notification-service → Deployments
  - **Verify**: Deployments page loads with deployment list
- [x] 5.4.2 **Verify**: Latest deployment shows "Success" status (green indicator)
- [x] 5.4.3 **Verify**: Health check shows "Healthy" (green checkmark next to deployment)
- [x] 5.4.4 Open Railway dashboard → notification-service → Logs
  - **Verify**: Logs tab loads with streaming logs
- [x] 5.4.5 **Verify**: Application startup logs show no `error` or `exception` keywords
- [x] 5.4.6 **Verify**: Logs show "Listening on http://[::]:PORT" or "Now listening on"
- [x] 5.4.7 (Optional) Use Railway CLI to view logs: `railway logs`
  - **Verify**: Logs stream to terminal matching dashboard
- [x] 5.4.8 **Verify**: Service Settings → Networking shows NO public domain
- [x] 5.4.9 Document internal URL for future services: `http://notification-service.railway.internal`
  - **Verify**: URL noted in service README or team documentation

### 5.5 Verify Observability Features

> **Purpose**: Confirm Railway's observability stack is working correctly.

#### Logs Verification
- [x] 5.5.1 Open Railway dashboard → Observability tab (top navigation)
  - **Verify**: Observability page loads with Log Explorer
- [x] 5.5.2 **Verify**: Logs from notification-service appear in Log Explorer
- [x] 5.5.3 **Verify**: Logs are in JSON format — each line starts with `{` and contains `"level"` and `"message"`
- [x] 5.5.4 Test log filtering: enter `@level:info` in search box
  - **Verify**: Only info-level logs shown, others filtered out
- [x] 5.5.5 Test log filtering: enter `@level:error` in search box
  - **Verify**: Only error-level logs shown (or "no results" if no errors)
- [x] 5.5.6 **Verify**: Custom attributes are searchable — test with app-specific attribute if available

#### Metrics Verification
- [x] 5.5.7 Open Railway dashboard → notification-service → Metrics tab
- [x] 5.5.8 **Verify**: CPU usage graph is visible
- [x] 5.5.9 **Verify**: Memory usage graph is visible
- [x] 5.5.10 **Verify**: Network I/O graph is visible
- [x] 5.5.11 **Verify**: Deployment markers appear on graphs (dotted lines)

#### Log Search Examples (Document for future reference)
- [x] 5.5.12 Document useful log queries:
  - All errors: `@level:error`
  - Telegram provider logs: `"telegram"` or `@provider:telegram`
  - Specific time range: Use date picker in Log Explorer

### 5.6 Test Railway CLI Debugging Tools

> **Purpose**: Verify SSH and logs access work for production debugging.

- [x] 5.6.1 View deployment logs via CLI: `railway logs`
  - **Verify**: Command executes without errors
- [x] 5.6.2 **Verify**: Logs stream to terminal — new log lines appear as app runs
- [x] 5.6.3 View build logs: `railway logs --build`
  - **Verify**: Build output shown (dotnet restore, build steps)
- [x] 5.6.4 SSH into running container: `railway ssh`
  - **Verify**: Command connects without timeout
- [x] 5.6.5 **Verify**: Shell prompt appears — shows `#` or `$` prompt
- [x] 5.6.6 Execute single command: `railway ssh -- ls /app`
  - **Verify**: Command returns file listing
- [x] 5.6.7 **Verify**: App files visible — `NotificationService.dll` in listing
- [x] 5.6.8 Document SSH debugging workflow in CI/CD overview
  - **Verify**: SSH section added to `docs/ci-cd/README.md`

## Phase 6: Documentation Updates

> **Dependencies**: Phase 5 complete and verified.

### 6.1 Update Project Documentation

- [x] 6.1.1 Open `openspec/project.md`
  - **Verify**: File opens without errors
- [x] 6.1.2 Add section: "CD Workflow Conventions"
  - **Verify**: Section heading exists with `##` markdown
- [x] 6.1.3 Document path filtering requirements
  - **Verify**: Path filter explanation present with examples
- [x] 6.1.4 Document Railway deployment process
  - **Verify**: Step-by-step deployment flow documented

### 6.2 Update Service Documentation

- [x] 6.2.1 Open `src/backend/notification-service/README.md`
  - **Verify**: File opens without errors
- [x] 6.2.2 Add section: "Deployment to Railway"
  - **Verify**: Section explains deployment is automatic on merge to master
- [x] 6.2.3 Document Railway Variables setup
  - **Verify**: Lists required variables: `Telegram__BotToken`, `Telegram__ChatId`
- [x] 6.2.4 Document health endpoint
  - **Verify**: Documents `/health` endpoint and its purpose

### 6.3 Create CI/CD Overview Document

- [x] 6.3.1 Create directory: `docs/ci-cd/`
  - **Verify**: Directory exists after creation
- [x] 6.3.2 Create file: `docs/ci-cd/README.md` (CI/CD Overview)
  - **Verify**: File exists with title and introduction
- [x] 6.3.3 Document high-level CD workflow (diagram from design.md)
  - **Verify**: Mermaid diagram or image included
- [x] 6.3.4 Document workflow file structure (template vs caller pattern)
  - **Verify**: Explains `template-dotnet-ci.yml` and caller workflow relationship
- [x] 6.3.5 Document versioning strategy (semantic versioning, changelog)
  - **Verify**: Explains `feat:` → minor, `fix:` → patch, `BREAKING CHANGE:` → major
- [x] 6.3.6 Document git tagging convention (`<service-name>/v<version>`)
  - **Verify**: Shows example: `notification-service/v1.2.3`
- [x] 6.3.7 Document secrets management (GitHub secrets vs Railway Variables)
  - **Verify**: Table or list distinguishing CI secrets vs app secrets
- [x] 6.3.8 Document observability strategy:
  - Structured JSON logging format and configuration
  - Railway Log Explorer and filtering syntax (`@level:error`, `@attribute:value`)
  - Built-in metrics (CPU, Memory, Network) location in dashboard
  - Useful log queries for debugging
  - **Verify**: All 4 sub-items documented with examples
- [x] 6.3.9 Document Railway CLI for local development:
  - Installation and login
  - `railway run` for running with production secrets
  - `railway shell` for shell access
  - `railway variables` for viewing config
  - **Verify**: All 4 commands documented with examples
- [x] 6.3.10 Document Railway CLI for production debugging:
  - `railway logs` for viewing logs
  - `railway ssh` for container access
  - SSH limitations and best practices
  - **Verify**: All 3 items documented with examples
- [x] 6.3.11 Link to OpenSpec `ci-pipeline` spec for detailed requirements
  - **Verify**: Link points to correct spec file

### 6.4 Create Service Onboarding Guide

- [x] 6.4.1 Create file: `docs/ci-cd/adding-service-to-cd.md`
  - **Verify**: File exists with title and introduction
- [x] 6.4.2 Document step-by-step guide for adding new service
  - **Verify**: Numbered steps from start to finish
- [x] 6.4.3 Include workflow file template (copy-paste ready)
  - **Verify**: YAML code block with placeholders marked (e.g., `<SERVICE_NAME>`)
- [x] 6.4.4 Include railway.json template
  - **Verify**: JSON code block with all required fields
- [x] 6.4.5 Document GitHub secrets configuration steps
  - **Verify**: Screenshots or step descriptions for Settings → Secrets
- [x] 6.4.6 Document Railway Variables configuration steps
  - **Verify**: Screenshots or step descriptions for Railway dashboard
- [x] 6.4.7 Include checklist for service readiness (health endpoint, version property)
  - **Verify**: Checkbox list with all prerequisites from Phase 1

### 6.5 Verify Documentation Completeness

- [x] 6.5.1 Review all documentation for accuracy
  - **Verify**: No placeholder text like `TODO` or `TBD` remains
- [x] 6.5.2 Verify all links work correctly
  - **Verify**: Click each link — no 404 errors
- [x] 6.5.3 Verify code examples are correct
  - **Verify**: YAML/JSON examples have valid syntax
- [x] 6.5.4 **Verify**: A new developer could follow guides to add a new service (walkthrough test)

---

## Definition of Done

All items below MUST be verified before archiving this change:

- [x] All Phase 1-6 tasks marked complete
- [x] Local CI passes: `./ci.ps1 -ServicePath "src/backend/notification-service"`
- [x] Test PR created, merged, and deployed successfully
- [x] Git tag exists: `notification-service/v1.x.x`
- [x] Railway deployment shows "Success" with healthy status
- [x] Service is internal only (no public domain)
- [x] Railway logs show successful startup in JSON format
- [x] Railway metrics visible (CPU, Memory, Network)
- [x] Log filtering works in Railway Observability tab
- [x] Documentation updated and reviewed
- [x] No workflow errors in GitHub Actions history

---

## Rollback Procedure

If deployment fails after merge:

1. **Revert merge commit** on master branch
2. Railway will auto-deploy previous version (if applicable)
3. Delete the created git tag if needed: `git tag -d <tag> && git push origin :refs/tags/<tag>`
4. Investigate and fix the issue before retrying

---

## Troubleshooting FAQ

| Problem | Solution |
|---------|----------|
| Railway deployment fails with "service not found" | Verify `RAILWAY_SERVICE_ID` secret matches Service ID in Railway dashboard |
| Version bump creates duplicate tag | Delete existing tag and re-run workflow |
| Workflow triggers infinite loop | Ensure commit message contains `[skip ci]` or check `github.actor` condition |
| Health check fails on Railway | Verify `/health` endpoint exists and returns 200 OK |
| Railway CLI authentication fails | Regenerate project token in Railway dashboard and update GitHub secret |
| Permission denied when pushing tag | Verify `permissions: contents: write` is set in caller workflow |
| Version not bumped | Check commits contain `feat:` or `fix:` prefix with conventional format |
| `railway run` says "no linked project" | Run `railway link` from repo root to link project |
| `railway ssh` fails with "no shell" | Container uses scratch image without shell — check Dockerfile |
| `railway variables` shows empty | Ensure service is linked: `railway service` → select service |
| Logs not in JSON format in Railway | Verify Serilog uses `JsonFormatter` in appsettings.json |
