## Prerequisites

> **IMPORTANT**: Complete all prerequisite tasks BEFORE starting implementation phases.

- [ ] 0.1 Read and understand `design.md` thoroughly
  - **Verify**: Can explain the CD workflow diagram to a colleague
- [ ] 0.2 Confirm Railway account access and permissions
  - **Verify**: Can log in to https://railway.app/dashboard
- [ ] 0.3 Confirm GitHub repository admin access (for secrets configuration)
  - **Verify**: Can access repository Settings → Secrets and variables → Actions
- [ ] 0.4 Review current `notification-service-ci.yml` workflow structure
  - **Verify**: Can identify where deployment job will be added

## Phase 1: Service Preparation (Critical Blockers)

> **Dependencies**: None. These tasks MUST be completed first.

### 1.1 Add Health Endpoint

- [ ] 1.1.1 Open `src/backend/notification-service/NotificationService/Bootstrap/ServiceBootstrap.cs`
- [ ] 1.1.2 Add health endpoint in `ConfigurePipeline` method: `app.MapGet("/health", () => Results.Ok(new { status = "healthy" }))`
- [ ] 1.1.3 Add OpenAPI metadata: `.WithName("HealthCheck").WithTags("Infrastructure")`
- [ ] 1.1.4 **Verify**: Run `dotnet run` and access `http://localhost:5272/health` — should return `{"status":"healthy"}`

### 1.2 Add Version Property

- [ ] 1.2.1 Open `src/backend/notification-service/NotificationService/NotificationService.csproj`
- [ ] 1.2.2 Add `<Version>1.0.0</Version>` inside `<PropertyGroup>`
- [ ] 1.2.3 **Verify**: Run `dotnet build` and check output for version number

### 1.3 Verify PORT Binding

- [ ] 1.3.1 Review `Program.cs` — confirm `app.Run()` does not hardcode port
- [ ] 1.3.2 Test locally: set `PORT=8080` environment variable, run app, verify it listens on port 8080
- [ ] 1.3.3 **Verify**: `curl http://localhost:8080/health` returns 200 OK

### 1.4 Create Initial CHANGELOG.md

> **Purpose**: Changelog will be auto-updated by CD pipeline on each release.

- [ ] 1.4.1 Create file: `src/backend/notification-service/CHANGELOG.md`
- [ ] 1.4.2 Add initial content:
  ```markdown
  # Changelog

  All notable changes to this project will be documented in this file.

  The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
  and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

  <!-- Entries below this line are auto-generated by CI/CD pipeline -->
  ```
- [ ] 1.4.3 **Verify**: File exists and is valid markdown

### 1.5 Configure Structured Logging for Railway Observability

> **Purpose**: Railway's Log Explorer works best with structured JSON logs for filtering and searching.

- [ ] 1.5.1 Open `src/backend/notification-service/NotificationService/appsettings.json`
- [ ] 1.5.2 Update Serilog configuration to use JSON output format:
  ```json
  "Serilog": {
    "MinimumLevel": "Information",
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "formatter": "Serilog.Formatting.Json.JsonFormatter, Serilog"
        }
      }
    ]
  }
  ```
- [ ] 1.5.3 Add Serilog.Formatting.Json package if not present: `dotnet add package Serilog.Formatting.Json`
- [ ] 1.5.4 Add structured log context where appropriate (e.g., provider name, recipient)
- [ ] 1.5.5 **Verify**: Run app and check console output is single-line JSON
- [ ] 1.5.6 **Verify**: Log output contains `level`, `message`, and `timestamp` fields

## Phase 2: Railway Project Setup

> **Dependencies**: Phase 1 complete. Railway account access required.

### 2.0 Install and Configure Railway CLI

> **Purpose**: Railway CLI enables local development with production secrets and production debugging.

- [ ] 2.0.1 Install Railway CLI: `npm i -g @railway/cli` (or `scoop install railway` on Windows)
- [ ] 2.0.2 **Verify**: Run `railway --version` — should show version number
- [ ] 2.0.3 Login to Railway: `railway login`
- [ ] 2.0.4 **Verify**: Run `railway whoami` — should show your account
- [ ] 2.0.5 (After project creation) Link to project: `railway link` from repo root
- [ ] 2.0.6 (After project creation) Link to service: `railway service` → select notification-service
- [ ] 2.0.7 **Verify**: Run `railway status` — should show linked project and service

### 2.1 Create Railway Project Structure

- [ ] 2.1.1 Log in to Railway dashboard: https://railway.app/dashboard
  - **Verify**: Dashboard loads without errors
- [ ] 2.1.2 Create new project (or use existing): name it `mono-repo` or similar
  - **Verify**: Project appears in dashboard project list
- [ ] 2.1.3 Create service within project: name it `notification-service`
  - **Verify**: Service card visible in project canvas
- [ ] 2.1.4 **IMPORTANT**: Do NOT create a public domain for notification-service (internal only)
- [ ] 2.1.5 **Verify**: Service Settings → Networking → No public domain assigned
- [ ] 2.1.6 Note internal hostname: `notification-service.railway.internal` (for future services)
  - **Verify**: Hostname documented in this task or service README

### 2.2 Configure Railway Secrets

- [ ] 2.2.1 Navigate to Railway dashboard → notification-service → Variables
  - **Verify**: Variables tab is accessible
- [ ] 2.2.2 Add `Telegram__BotToken` with value from Telegram BotFather
  - **Verify**: Variable appears in list after saving
- [ ] 2.2.3 Mark `Telegram__BotToken` as "sealed" if available
  - **Verify**: Variable shows "sealed" indicator (if feature exists)
- [ ] 2.2.4 Add `Telegram__ChatId` with chat ID value
  - **Verify**: Variable appears in list after saving
- [ ] 2.2.5 **Verify**: Both variables visible in Railway dashboard (2 variables total)

### 2.3 Get Railway Credentials

- [ ] 2.3.1 Navigate to Railway dashboard → Project Settings → Tokens
  - **Verify**: Tokens section is accessible
- [ ] 2.3.2 Create new project token (NOT account token)
  - **Verify**: New token appears in list with creation date
- [ ] 2.3.3 Copy token value (will be used as `RAILWAY_TOKEN`)
  - **Verify**: Token copied to clipboard or password manager
- [ ] 2.3.4 Navigate to Service → Settings → copy Service ID
  - **Verify**: Service ID is a UUID format (e.g., `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`)
- [ ] 2.3.5 **Verify**: Both token and service ID saved securely (password manager or secure notes)

### 2.4 Create Railway Configuration File

- [ ] 2.4.1 Create file: `src/backend/notification-service/railway.json`
  - **Verify**: File exists at correct path
- [ ] 2.4.2 Add JSON schema reference: `"$schema": "https://railway.com/railway.schema.json"`
  - **Verify**: VS Code shows schema validation (IntelliSense works)
- [ ] 2.4.3 Add `deploy.startCommand`: `"dotnet NotificationService.dll --urls http://*:$PORT"`
  - **Verify**: No schema validation errors on this field
- [ ] 2.4.4 Add `deploy.healthcheckPath`: `"/health"`
  - **Verify**: Path matches endpoint added in 1.1
- [ ] 2.4.5 Add `deploy.healthcheckTimeout`: `30`
  - **Verify**: Value is number, not string
- [ ] 2.4.6 **Verify**: JSON syntax is valid — no red squiggles in VS Code

### 2.5 Configure GitHub Secrets

- [ ] 2.5.1 Navigate to GitHub repository → Settings → Secrets and variables → Actions
  - **Verify**: Actions secrets page is accessible
- [ ] 2.5.2 Add new repository secret: `RAILWAY_TOKEN` with token from step 2.3.3
  - **Verify**: Secret appears in list with "Updated just now" timestamp
- [ ] 2.5.3 Add new repository secret: `RAILWAY_SERVICE_ID` with ID from step 2.3.4
  - **Verify**: Secret appears in list with "Updated just now" timestamp
- [ ] 2.5.4 **Verify**: Both secrets appear in "Repository secrets" section (2 secrets total)

## Phase 3: CI/CD Workflow Extension

> **Dependencies**: Phase 2 complete. GitHub admin access required.

### 3.1 Update Reusable Workflow Template

- [ ] 3.1.1 Open `.github/workflows/template-dotnet-ci.yml`
  - **Verify**: File opens without errors
- [ ] 3.1.2 Add input parameter: `railway_service_id` (type: string, required: false)
  - **Verify**: Parameter appears in `inputs:` section
- [ ] 3.1.3 Add secret parameter: `RAILWAY_TOKEN` (required: false)
  - **Verify**: Secret appears in `secrets:` section
- [ ] 3.1.4 Add new job `deploy` after `validate` job
  - **Verify**: Job appears after `validate` in jobs section
- [ ] 3.1.5 Add job dependency: `needs: [validate]`
  - **Verify**: `needs:` key present in deploy job
- [ ] 3.1.6 Add job condition: `if: ${{ inputs.railway_service_id != '' && github.ref == 'refs/heads/master' && github.actor != 'github-actions[bot]' }}`
  - **Verify**: `if:` key present with all 3 conditions
- [ ] 3.1.7 Add concurrency control to prevent race conditions:
  ```yaml
  concurrency:
    group: deploy-${{ inputs.service_name }}
    cancel-in-progress: false
  ```
  - **Verify**: `concurrency:` block present with correct group name
- [ ] 3.1.8 Add checkout step with `fetch-depth: 0` (needed for git tags)
  - **Verify**: `actions/checkout` step has `fetch-depth: 0`
- [ ] 3.1.9 Add git config step for automated commits
  - **Verify**: Step sets `user.name` and `user.email`
- [ ] 3.1.10 Add Railway CLI deployment step using Docker container
  - **Verify**: Step uses Railway CLI or Docker image
- [ ] 3.1.11 **Verify**: Run `yamllint` or use VS Code YAML extension — no syntax errors

### 3.2 Update Caller Workflow

- [ ] 3.2.1 Open `.github/workflows/notification-service-ci.yml`
  - **Verify**: File opens without errors
- [ ] 3.2.2 Add `paths` filter to `on.pull_request` trigger (currently missing!)
  - **Verify**: `paths:` key present under `pull_request:`
- [ ] 3.2.3 Verify `paths` filter on `on.push` trigger includes workflow file
  - **Verify**: `.github/workflows/notification-service-ci.yml` in paths list
- [ ] 3.2.4 Add `permissions: contents: write` at workflow level
  - **Verify**: `permissions:` block present at top level (not inside jobs)
- [ ] 3.2.5 Pass `railway_service_id` input to reusable workflow
  - **Verify**: `railway_service_id: ${{ secrets.RAILWAY_SERVICE_ID }}` in `with:` block
- [ ] 3.2.6 Pass `RAILWAY_TOKEN` secret using `secrets: inherit` or explicit passing
  - **Verify**: Either `secrets: inherit` or explicit `RAILWAY_TOKEN:` present
- [ ] 3.2.7 **Verify**: Run `yamllint` or use VS Code YAML extension — no syntax errors

### 3.3 Add Commit Loop Prevention

- [ ] 3.3.1 Add condition to skip workflow when triggered by bot: `github.actor != 'github-actions[bot]'`
  - **Verify**: Condition present in job-level or workflow-level `if:`
- [ ] 3.3.2 Use `[skip ci]` in automated commit messages as fallback
  - **Verify**: Commit message template includes `[skip ci]` suffix
- [ ] 3.3.3 **Verify**: Both mechanisms in place (actor check + skip ci message)

## Phase 4: Version Management Scripts

> **Dependencies**: Phase 3 structure complete.

### 4.1 Create Version Bump Script

- [ ] 4.1.1 Create directory: `.github/scripts/`
  - **Verify**: Directory exists after creation
- [ ] 4.1.2 Create file: `.github/scripts/bump-version.sh`
  - **Verify**: File exists with shebang `#!/bin/bash`
- [ ] 4.1.3 Implement: Extract current version from `.csproj` file
  - **Verify**: Script can parse `<Version>1.0.0</Version>` correctly
- [ ] 4.1.4 Implement: Get last git tag for service using pattern `<service-name>/v*`
  - **Verify**: Script outputs correct tag or "no tag found"
- [ ] 4.1.5 Implement: Handle first release (no previous tag) — use all commits or default to 1.0.0
  - **Verify**: Script doesn't fail when no tags exist
- [ ] 4.1.6 Implement: Parse commits since last tag for `feat:`, `fix:`, `BREAKING CHANGE:`
  - **Verify**: Script correctly categorizes test commits
- [ ] 4.1.7 Implement: Calculate new version (major/minor/patch bump)
  - **Verify**: `feat:` → minor bump, `fix:` → patch bump, `BREAKING CHANGE:` → major bump
- [ ] 4.1.8 Implement: Handle case when no version-bumping commits exist (exit gracefully)
  - **Verify**: Script exits with code 0 and message "No version bump needed"
- [ ] 4.1.9 Implement: Update version in `.csproj` file
  - **Verify**: `.csproj` file modified with new version
- [ ] 4.1.10 Make script executable: `chmod +x .github/scripts/bump-version.sh`
  - **Verify**: `ls -la` shows executable permission
- [ ] 4.1.11 **Verify**: Run script manually: `./bump-version.sh notification-service src/backend/notification-service` — outputs expected version

### 4.2 Create Changelog Generator Script

- [ ] 4.2.1 Create file: `.github/scripts/generate-changelog.sh`
  - **Verify**: File exists with shebang `#!/bin/bash`
- [ ] 4.2.2 Implement: Parse commits since last tag
  - **Verify**: Script correctly lists commits between tags
- [ ] 4.2.3 Implement: Group commits by type (Added, Fixed, Changed, Other)
  - **Verify**: `feat:` → Added, `fix:` → Fixed, `refactor:` → Changed
- [ ] 4.2.4 Implement: Format as markdown with version header and date
  - **Verify**: Output includes `## [1.x.x] - YYYY-MM-DD` format
- [ ] 4.2.5 Implement: Handle first release (create new CHANGELOG.md)
  - **Verify**: Script creates file if it doesn't exist
- [ ] 4.2.6 Implement: Prepend to existing CHANGELOG.md
  - **Verify**: New entry appears at top, old entries preserved
- [ ] 4.2.7 Make script executable: `chmod +x .github/scripts/generate-changelog.sh`
  - **Verify**: `ls -la` shows executable permission
- [ ] 4.2.8 **Verify**: Run script manually: `./generate-changelog.sh notification-service 1.1.0 src/backend/notification-service` — CHANGELOG.md updated correctly

### 4.3 Integrate Scripts into Workflow

- [ ] 4.3.1 Add workflow step to run version bump script
  - **Verify**: Step runs `bash .github/scripts/bump-version.sh` with correct args
- [ ] 4.3.2 Add workflow step to run changelog generator
  - **Verify**: Step runs `bash .github/scripts/generate-changelog.sh` with correct args
- [ ] 4.3.3 Add step to commit version + changelog with message: `chore(<service>): release v<version> [skip ci]`
  - **Verify**: `git commit` command includes `[skip ci]` in message
- [ ] 4.3.4 Add step to push commit using `GITHUB_TOKEN`
  - **Verify**: Step uses `${{ secrets.GITHUB_TOKEN }}` or default token
- [ ] 4.3.5 Add step to create git tag: `<service-name>/v<version>`
  - **Verify**: `git tag` command uses correct naming pattern
- [ ] 4.3.6 Add step to push git tag (only after successful deployment)
  - **Verify**: Tag push step is AFTER Railway deployment step
- [ ] 4.3.7 **Verify**: All steps in correct order: bump → changelog → commit → push → deploy → tag

## Phase 5: Integration Testing

> **Dependencies**: All previous phases complete.

### 5.0 Test Local Development with Railway CLI

> **Purpose**: Verify Railway CLI integration for local development workflow.

- [ ] 5.0.1 Ensure Railway CLI is linked: `railway status`
  - **Verify**: Output shows project name and environment
- [ ] 5.0.2 View variables from Railway: `railway variables`
- [ ] 5.0.3 **Verify**: Telegram__BotToken and Telegram__ChatId are visible in output
- [ ] 5.0.4 Run app locally with Railway secrets:
  ```bash
  cd src/backend/notification-service/NotificationService
  railway run dotnet run
  ```
- [ ] 5.0.5 **Verify**: App starts without "missing configuration" or "null reference" errors
- [ ] 5.0.6 Open Railway shell: `railway shell` and verify variables with `echo $Telegram__BotToken`
  - **Verify**: Token value is printed (not empty)
- [ ] 5.0.7 Document local development workflow in service README
  - **Verify**: README includes `railway run` instructions

### 5.1 Local CI Validation

- [ ] 5.1.1 Run local CI: `./ci.ps1 -ServicePath "src/backend/notification-service" -CoverageThreshold 80`
  - **Verify**: Command executes without PowerShell errors
- [ ] 5.1.2 Fix any format, build, or test errors
  - **Verify**: All errors resolved, no warnings treated as errors
- [ ] 5.1.3 **Verify**: Local CI passes — all checkmarks green, exit code 0

### 5.2 Test PR Workflow

- [ ] 5.2.1 Create test branch: `spec/plan-feature`
  - **Verify**: Branch created with `git checkout -b spec/plan-feature`
- [ ] 5.2.2 Make small change to `src/backend/notification-service/**`
  - **Verify**: At least one file modified (e.g., add comment or update version)
- [ ] 5.2.3 Create pull request to `master`
  - **Verify**: PR appears in GitHub with correct base branch
- [ ] 5.2.4 **Verify**: CI workflow triggers — check GitHub Actions tab shows running workflow
- [ ] 5.2.5 **Verify**: CI passes with green checkmark on PR
- [ ] 5.2.6 **Verify**: Deployment job shows "Skipped" (not on master yet)

### 5.3 Test Merge and Deployment

- [ ] 5.3.1 Merge PR to `master`
- [ ] 5.3.2 **Verify**: Deployment workflow triggers automatically
- [ ] 5.3.3 **Verify**: Version is bumped in `.csproj`
- [ ] 5.3.4 **Verify**: CHANGELOG.md is updated with new version entry
- [ ] 5.3.5 **Verify**: CHANGELOG.md entry contains date and commit summaries
- [ ] 5.3.6 **Verify**: Commit is pushed with `[skip ci]` message
- [ ] 5.3.7 **Verify**: Railway deployment succeeds (check Railway dashboard)
- [ ] 5.3.8 **Verify**: Git tag is created: `notification-service/v1.x.x`
- [ ] 5.3.9 **Verify**: Health endpoint accessible on Railway URL

### 5.4 Verify Railway Deployment (Internal Service)

> **Note**: notification-service is internal only — NO public domain. Verification via logs and Railway dashboard.

- [ ] 5.4.1 Open Railway dashboard → notification-service → Deployments
  - **Verify**: Deployments page loads with deployment list
- [ ] 5.4.2 **Verify**: Latest deployment shows "Success" status (green indicator)
- [ ] 5.4.3 **Verify**: Health check shows "Healthy" (green checkmark next to deployment)
- [ ] 5.4.4 Open Railway dashboard → notification-service → Logs
  - **Verify**: Logs tab loads with streaming logs
- [ ] 5.4.5 **Verify**: Application startup logs show no `error` or `exception` keywords
- [ ] 5.4.6 **Verify**: Logs show "Listening on http://[::]:PORT" or "Now listening on"
- [ ] 5.4.7 (Optional) Use Railway CLI to view logs: `railway logs`
  - **Verify**: Logs stream to terminal matching dashboard
- [ ] 5.4.8 **Verify**: Service Settings → Networking shows NO public domain
- [ ] 5.4.9 Document internal URL for future services: `http://notification-service.railway.internal`
  - **Verify**: URL noted in service README or team documentation

### 5.5 Verify Observability Features

> **Purpose**: Confirm Railway's observability stack is working correctly.

#### Logs Verification
- [ ] 5.5.1 Open Railway dashboard → Observability tab (top navigation)
  - **Verify**: Observability page loads with Log Explorer
- [ ] 5.5.2 **Verify**: Logs from notification-service appear in Log Explorer
- [ ] 5.5.3 **Verify**: Logs are in JSON format — each line starts with `{` and contains `"level"` and `"message"`
- [ ] 5.5.4 Test log filtering: enter `@level:info` in search box
  - **Verify**: Only info-level logs shown, others filtered out
- [ ] 5.5.5 Test log filtering: enter `@level:error` in search box
  - **Verify**: Only error-level logs shown (or "no results" if no errors)
- [ ] 5.5.6 **Verify**: Custom attributes are searchable — test with app-specific attribute if available

#### Metrics Verification
- [ ] 5.5.7 Open Railway dashboard → notification-service → Metrics tab
- [ ] 5.5.8 **Verify**: CPU usage graph is visible
- [ ] 5.5.9 **Verify**: Memory usage graph is visible
- [ ] 5.5.10 **Verify**: Network I/O graph is visible
- [ ] 5.5.11 **Verify**: Deployment markers appear on graphs (dotted lines)

#### Log Search Examples (Document for future reference)
- [ ] 5.5.12 Document useful log queries:
  - All errors: `@level:error`
  - Telegram provider logs: `"telegram"` or `@provider:telegram`
  - Specific time range: Use date picker in Log Explorer

### 5.6 Test Railway CLI Debugging Tools

> **Purpose**: Verify SSH and logs access work for production debugging.

- [ ] 5.6.1 View deployment logs via CLI: `railway logs`
  - **Verify**: Command executes without errors
- [ ] 5.6.2 **Verify**: Logs stream to terminal — new log lines appear as app runs
- [ ] 5.6.3 View build logs: `railway logs --build`
  - **Verify**: Build output shown (dotnet restore, build steps)
- [ ] 5.6.4 SSH into running container: `railway ssh`
  - **Verify**: Command connects without timeout
- [ ] 5.6.5 **Verify**: Shell prompt appears — shows `#` or `$` prompt
- [ ] 5.6.6 Execute single command: `railway ssh -- ls /app`
  - **Verify**: Command returns file listing
- [ ] 5.6.7 **Verify**: App files visible — `NotificationService.dll` in listing
- [ ] 5.6.8 Document SSH debugging workflow in CI/CD overview
  - **Verify**: SSH section added to `docs/ci-cd/README.md`

## Phase 6: Documentation Updates

> **Dependencies**: Phase 5 complete and verified.

### 6.1 Update Project Documentation

- [ ] 6.1.1 Open `openspec/project.md`
  - **Verify**: File opens without errors
- [ ] 6.1.2 Add section: "CD Workflow Conventions"
  - **Verify**: Section heading exists with `##` markdown
- [ ] 6.1.3 Document path filtering requirements
  - **Verify**: Path filter explanation present with examples
- [ ] 6.1.4 Document Railway deployment process
  - **Verify**: Step-by-step deployment flow documented

### 6.2 Update Service Documentation

- [ ] 6.2.1 Open `src/backend/notification-service/README.md`
  - **Verify**: File opens without errors
- [ ] 6.2.2 Add section: "Deployment to Railway"
  - **Verify**: Section explains deployment is automatic on merge to master
- [ ] 6.2.3 Document Railway Variables setup
  - **Verify**: Lists required variables: `Telegram__BotToken`, `Telegram__ChatId`
- [ ] 6.2.4 Document health endpoint
  - **Verify**: Documents `/health` endpoint and its purpose

### 6.3 Create CI/CD Overview Document

- [ ] 6.3.1 Create directory: `docs/ci-cd/`
  - **Verify**: Directory exists after creation
- [ ] 6.3.2 Create file: `docs/ci-cd/README.md` (CI/CD Overview)
  - **Verify**: File exists with title and introduction
- [ ] 6.3.3 Document high-level CD workflow (diagram from design.md)
  - **Verify**: Mermaid diagram or image included
- [ ] 6.3.4 Document workflow file structure (template vs caller pattern)
  - **Verify**: Explains `template-dotnet-ci.yml` and caller workflow relationship
- [ ] 6.3.5 Document versioning strategy (semantic versioning, changelog)
  - **Verify**: Explains `feat:` → minor, `fix:` → patch, `BREAKING CHANGE:` → major
- [ ] 6.3.6 Document git tagging convention (`<service-name>/v<version>`)
  - **Verify**: Shows example: `notification-service/v1.2.3`
- [ ] 6.3.7 Document secrets management (GitHub secrets vs Railway Variables)
  - **Verify**: Table or list distinguishing CI secrets vs app secrets
- [ ] 6.3.8 Document observability strategy:
  - Structured JSON logging format and configuration
  - Railway Log Explorer and filtering syntax (`@level:error`, `@attribute:value`)
  - Built-in metrics (CPU, Memory, Network) location in dashboard
  - Useful log queries for debugging
  - **Verify**: All 4 sub-items documented with examples
- [ ] 6.3.9 Document Railway CLI for local development:
  - Installation and login
  - `railway run` for running with production secrets
  - `railway shell` for shell access
  - `railway variables` for viewing config
  - **Verify**: All 4 commands documented with examples
- [ ] 6.3.10 Document Railway CLI for production debugging:
  - `railway logs` for viewing logs
  - `railway ssh` for container access
  - SSH limitations and best practices
  - **Verify**: All 3 items documented with examples
- [ ] 6.3.11 Link to OpenSpec `ci-pipeline` spec for detailed requirements
  - **Verify**: Link points to correct spec file

### 6.4 Create Service Onboarding Guide

- [ ] 6.4.1 Create file: `docs/ci-cd/adding-service-to-cd.md`
  - **Verify**: File exists with title and introduction
- [ ] 6.4.2 Document step-by-step guide for adding new service
  - **Verify**: Numbered steps from start to finish
- [ ] 6.4.3 Include workflow file template (copy-paste ready)
  - **Verify**: YAML code block with placeholders marked (e.g., `<SERVICE_NAME>`)
- [ ] 6.4.4 Include railway.json template
  - **Verify**: JSON code block with all required fields
- [ ] 6.4.5 Document GitHub secrets configuration steps
  - **Verify**: Screenshots or step descriptions for Settings → Secrets
- [ ] 6.4.6 Document Railway Variables configuration steps
  - **Verify**: Screenshots or step descriptions for Railway dashboard
- [ ] 6.4.7 Include checklist for service readiness (health endpoint, version property)
  - **Verify**: Checkbox list with all prerequisites from Phase 1

### 6.5 Verify Documentation Completeness

- [ ] 6.5.1 Review all documentation for accuracy
  - **Verify**: No placeholder text like `TODO` or `TBD` remains
- [ ] 6.5.2 Verify all links work correctly
  - **Verify**: Click each link — no 404 errors
- [ ] 6.5.3 Verify code examples are correct
  - **Verify**: YAML/JSON examples have valid syntax
- [ ] 6.5.4 **Verify**: A new developer could follow guides to add a new service (walkthrough test)

---

## Definition of Done

All items below MUST be verified before archiving this change:

- [ ] All Phase 1-6 tasks marked complete
- [ ] Local CI passes: `./ci.ps1 -ServicePath "src/backend/notification-service"`
- [ ] Test PR created, merged, and deployed successfully
- [ ] Git tag exists: `notification-service/v1.x.x`
- [ ] Railway deployment shows "Success" with healthy status
- [ ] Service is internal only (no public domain)
- [ ] Railway logs show successful startup in JSON format
- [ ] Railway metrics visible (CPU, Memory, Network)
- [ ] Log filtering works in Railway Observability tab
- [ ] Documentation updated and reviewed
- [ ] No workflow errors in GitHub Actions history

---

## Rollback Procedure

If deployment fails after merge:

1. **Revert merge commit** on master branch
2. Railway will auto-deploy previous version (if applicable)
3. Delete the created git tag if needed: `git tag -d <tag> && git push origin :refs/tags/<tag>`
4. Investigate and fix the issue before retrying

---

## Troubleshooting FAQ

| Problem | Solution |
|---------|----------|
| Railway deployment fails with "service not found" | Verify `RAILWAY_SERVICE_ID` secret matches Service ID in Railway dashboard |
| Version bump creates duplicate tag | Delete existing tag and re-run workflow |
| Workflow triggers infinite loop | Ensure commit message contains `[skip ci]` or check `github.actor` condition |
| Health check fails on Railway | Verify `/health` endpoint exists and returns 200 OK |
| Railway CLI authentication fails | Regenerate project token in Railway dashboard and update GitHub secret |
| Permission denied when pushing tag | Verify `permissions: contents: write` is set in caller workflow |
| Version not bumped | Check commits contain `feat:` or `fix:` prefix with conventional format |
| `railway run` says "no linked project" | Run `railway link` from repo root to link project |
| `railway ssh` fails with "no shell" | Container uses scratch image without shell — check Dockerfile |
| `railway variables` shows empty | Ensure service is linked: `railway service` → select service |
| Logs not in JSON format in Railway | Verify Serilog uses `JsonFormatter` in appsettings.json |
